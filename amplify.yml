version: 1
applications:
  - appRoot: apps/dashboard
    api:
      phases:
        preBuild:
          commands:
            - cd ../..
            - npm i -g yarn
            - yarn install --ci
        build:
          commands:
            - yarn nx run api:build --prod --skip-nx-cache
            - cp node_modules apps/api
      artifacts:
        baseDirectory: dist/apps/dashboard
        files:
          - '**/*'

    auth:
      phases:
        build:
          commands:
            - cd ../..
            - npm i -g yarn
            - yarn install --ci
            - yarn nx run auth:build --prod --skip-nx-cache
            - cp node_modules apps/auth
      artifacts:
        baseDirectory: ../../dist/apps/auth
        files:
          - '**/*'
      cache:
        paths:
          - node_modules/**/*

    dashboard:
      phases:
        build:
          commands:
            - cd ../..
            - npm i -g yarn
            - yarn install --ci
            - yarn nx run dashboard:build --prod --skip-nx-cache
            - cp node_modules apps/dashboard
      artifacts:
        baseDirectory: dist/apps/dashboard
        files:
          - '**/*'
      cache:
        paths:
          - node_modules/**/*
