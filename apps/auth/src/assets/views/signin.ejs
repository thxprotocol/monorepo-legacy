<script src="/js/vendors/detect.min.js"></script>
<% if (params.backgroundImgUrl) { %>
<style type="text/css">
  body {
    background-image: url("<%- params.backgroundImgUrl %>") !important;
    background-repeat: no-repeat;
    background-size: cover;
  }
</style>
<% } %>
<style type="text/css">
  @keyframes shine {
    to {
      background-position-x: -200%;
    }
  }

  .card {
    border: 0;
  }

  .fade-in {
    opacity: 0;
    transition: opacity ease .5s;
  }

  .card .card-header {
    padding: 0;
    height: 5px;
  }

  .fade-in.is-mounted {
    opacity: 1;
  }

  .card.is-loading .card-header {
    background: linear-gradient(90deg, rgba(0, 0, 0, 0.03) 10%, #5942c1 10%, #5942c1 90%, rgba(0, 0, 0, 0.03) 90%);
    background-size: 200% 100%;
    animation: 1.5s shine linear infinite;
  }
</style>
<div class="col-md-6 offset-md-3 col-xl-4 offset-xl-4 order-0 order-sm-1 fade-in" @vue:mounted="onMounted"
     :class="{ 'is-mounted': isMounted }">
  <div class="text-center pb-4 pt-3">
    <% if (params.logoImgUrl) { %>
    <img src="<%- params.logoImgUrl %>" width="60" alt="THX Logo" />
    <% } else { %>
    <img src="/img/logo.png" width="60" alt="THX Logo" />
    <% } %>
  </div>
  <div class="card shadow-sm" :class="{ 'is-loading': isLoading, 'is-mounted': isMounted }">
    <div class="card-header"></div>
    <div class="card-body p-sm-4 pb-sm-0">
      <% if (params.authRequestMessage) { %>
      <div v-if="alert && alert.message" class="alert" :class="`alert-${alert.variant}`">
        <i class="fas fa-exclamation-circle mr-2"></i>
        {{alert.message}}
      </div>
      <% } %>
      <% if (params.authentication_token && params.secure_key) { %> <strong
              class="h2 d-block text-dark text-center mb-4">
        Set a password
      </strong>
      <p>You are invited to access your THX Web Wallet. Set a password and accept the invite!</p>
      <% } %>
      <% if (locals.alert && alert.message) { %>
      <div class="alert alert-<%= alert.variant %>">
        <%- alert.message %>
      </div>
      <% } %>
      <p class="text-muted">Continue with a trusted provider</p>
      <div class="d-flex align-items-center justify-content-start flex-wrap">
        <% if (params.authRequestMessage) { %>
        <a style="width: 40px; height: 40px;" class="mr-2 mb-2 d-block p-1 btn btn-light" @click="signin()"
           data-toggle="tooltip" title="Sign in with Metamask">
          <img v-if="!isDisabledMetamask" width="25" src="/img/mm-logo.svg" alt="Metamask logo" />
          <div v-else class="spinner-border spinner-primary spinner-border-sm" role="status">
            <span class="sr-only">Loading...</span>
          </div>
        </a>
        <% } %>
        <% if (params.googleLoginUrl) { %>
        <a style="width: 40px; height: 40px;" class="mr-2 mb-2 d-block p-1 btn btn-light"
           href="<%= params.googleLoginUrl %>" data-toggle="tooltip" title="Sign in with Google">
          <img width="20" src="/img/g-logo.png" alt="Google logo" />
        </a>
        <% } %>
        <% if (params.twitterLoginUrl) { %>
        <a style="width: 40px; height: 40px;" class="mr-2 mb-2 d-block p-1 btn btn-light"
           href="<%= params.twitterLoginUrl %>" data-toggle="tooltip" title="Sign in with Twitter">
          <img width="20" src="/img/t-logo.png" alt="Twitter logo" />
        </a>
        <% } %>
        <% if (params.discordLoginUrl) { %>
        <a style="width: 40px; height: 40px;" class="mr-2 mb-2 d-block p-1 btn btn-light"
           href="<%= params.discordLoginUrl %>" data-toggle="tooltip" title="Sign in with Discord">
          <img width="20" src="/img/discord-logo.png" alt="Discord logo" />
        </a>
        <% } %>
        <% if (params.githubLoginUrl) { %>
        <a style="width: 40px; height: 40px;" class="mr-2 mb-2 d-block p-1 btn btn-light"
           href="<%= params.githubLoginUrl %>" data-toggle="tooltip" title="Sign in with Github">
          <img width="20" src="/img/github-logo.png" alt="github logo" />
        </a>
        <% } %>
        <% if (params.twitchLoginUrl) { %>
        <a style="width: 40px; height: 40px;" class="mr-2 mb-2 d-block p-1 btn btn-light"
           href="<%= params.twitchLoginUrl %>" data-toggle="tooltip" title="Sign in with Twitch">
          <img width="20" src="/img/twitch-logo.png" alt="twitch logo" />
        </a>
      </div>
      <p class="mt-2 text-muted">Or use your e-mail</p>
      <form id="form-signin" action="/oidc/<%= uid %>/signin" method="post" class="mt-3">

        <div class="form-group">
          <input placeholder="E-mail" class="form-control" class="form-control" required type="email" name="email"
                 v-model="email" :class="{
                  'is-valid': email && !isDisabled, 'is-invalid': email && isDisabled
              }">
        </div>

        <% if (params.mfaEnabled) { %>
        <label>MFA code:</label>
        <input class="form-control mb-4" required name="code">
        <% } %>

        <% if (params.authRequestMessage) { %>
        <input type="hidden" name="authRequestMessage" value="<%= params.authRequestMessage %>" />
        <input type="hidden" name="authRequestSignature" value="" />
        <script type="module" src="/js/signin.js"></script>
        <% } %>

        <input type="hidden" name="returnUrl" value="<%= params.return_url %>" />

        <% if (params.authRequestMessage) { %>
        <input type="hidden" name="claimUrl" value="<%= params.claimUrl %>" />
        <% } %>

        <button type="submit" class="btn rounded-pill btn-primary btn-block"
                :class="{'disabled': isDisabled || isLoading}" @click="onClickSubmit">
          Send one-time password
          <i class="fas fa-chevron-right" aria-hidden="true"></i>
        </button>
      </form>
    </div>

    <div class="card-footer d-flex align-items-center justify-content-center">
      <a href="https://discord.com/invite/TzbbSmkE7Y" class="text-muted">Help</a>
      <a href="" class="text-muted ml-3">Privacy</a>
      <a href="" class="text-muted ml-3">Terms</a>
    </div>
    <% } %>
  </div>
</div>